From 003384851dfff3efe5c16aafb274ef5cd3bc3078 Mon Sep 17 00:00:00 2001
From: Simon Fels <simon.fels@canonical.com>
Date: Fri, 22 Jul 2016 11:36:12 +0200
Subject: [PATCH] Add snappy runtime directory support

---
 obexd/src/main.c | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/obexd/src/main.c b/obexd/src/main.c
index 139f141..9f6c67a 100644
--- a/obexd/src/main.c
+++ b/obexd/src/main.c
@@ -286,11 +286,19 @@ int main(int argc, char *argv[])
 	}
 
 	if (option_root == NULL) {
-		option_root = g_build_filename(g_get_user_cache_dir(), "obexd",
-									NULL);
+		option_root = getenv("SNAP_USER_DATA");
+
+		if (!option_root)
+			option_root = g_build_filename(g_get_user_cache_dir(),
+							"obexd", NULL);
 		g_mkdir_with_parents(option_root, 0700);
 	}
 
+	/*
+	 * FIXME: a relative path option_root is specified on the command line,
+	 * will not be properly re-located to $SNAP_USER_DATA. Since this is
+	 * not used in the snap's obexd service file, this should be a no-op.
+	 */
 	if (option_root[0] != '/') {
 		const char *home = getenv("HOME");
 		if (home) {
-- 
2.17.1

